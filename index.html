<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>escaner de bichos</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; max-width: 600px; margin: 20px auto; padding: 20px; background-color: #f4f4f9; }
        .search-box { display: flex; gap: 10px; margin-bottom: 20px; }
        input { flex: 1; padding: 12px; border: 1px solid #ddd; border-radius: 5px; font-size: 16px; }
        button { padding: 12px 20px; background-color: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; }
        button:hover { background-color: #0056b3; }
        .product-card { background: white; padding: 15px; margin-bottom: 15px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); border-left: 10px solid #ccc; }
        .danger { border-left-color: #dc3545; background-color: #fff5f5; }
        .safe { border-left-color: #28a745; background-color: #f8fff8; }
        .badge { display: inline-block; padding: 4px 8px; border-radius: 4px; font-size: 12px; font-weight: bold; margin-top: 5px; }
        .badge-danger { background: #dc3545; color: white; }
        .badge-safe { background: #28a745; color: white; }
        img { max-height: 80px; float: right; border-radius: 4px; }
        .info { overflow: hidden; }
    </style>
</head>
<body>

    <h2>üîç Buscador de Productos</h2>
    <p>Busca por nombre (ej: "M&Ms", "Donettes", "Yogur") para detectar <b>E-904</b> o <b>E-120</b>.</p>
    
    <div class="search-box">
        <input type="text" id="searchInput" placeholder="Escribe el nombre del producto..." onkeypress="if(event.key === 'Enter') searchByName()">
        <button onclick="searchByName()">Buscar</button>
    </div>

    <div id="results"></div>

    <script>
        async function searchByName() {
            const query = document.getElementById('searchInput').value.trim();
            const resultsDiv = document.getElementById('results');
            
            if (!query) return;

            resultsDiv.innerHTML = "<p>Buscando productos...</p>";

            try {
                // Buscamos productos que coincidan con el nombre
                const url = `https://world.openfoodfacts.org/cgi/search.pl?search_terms=${encodeURIComponent(query)}&search_simple=1&action=process&json=1&page_size=20`;
                const response = await fetch(url);
                const data = await response.json();

                if (!data.products || data.products.length === 0) {
                    resultsDiv.innerHTML = "<p>No se encontraron productos con ese nombre.</p>";
                    return;
                }

                resultsDiv.innerHTML = ""; // Limpiar resultados anteriores

                data.products.forEach(product => {
                    const name = product.product_name || "Producto sin nombre";
                    const brand = product.brands || "Marca desconocida";
                    const image = product.image_small_url || "";
                    const additives = product.additives_tags || [];
                    
                    // Comprobar aditivos conflictivos
                    const found = additives.filter(a => a.includes('e120') || a.includes('e904'));
                    const isDanger = found.length > 0;

                    const card = document.createElement('div');
                    card.className = `product-card ${isDanger ? 'danger' : 'safe'}`;
                    
                    card.innerHTML = `
                        ${image ? `<img src="${image}" alt="producto">` : ''}
                        <div class="info">
                            <strong>${name}</strong><br>
                            <small>${brand}</small><br>
                            ${isDanger 
                                ? `<span class="badge badge-danger">CONTIENE: ${found.join(', ').toUpperCase().replace(/EN:/g, '')}</span>` 
                                : '<span class="badge badge-safe">LIBRE DE E-904 / E-120</span>'}
                        </div>
                    `;
                    resultsDiv.appendChild(card);
                });

            } catch (error) {
                resultsDiv.innerHTML = "<p>Error al conectar con la base de datos.</p>";
                console.error(error);
            }
        }
    </script>

</body>
</html>
